[
    {
        "label": "new conversation on Facebook",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "new_conversation",
            "channel_id": 10002,
            "urn_id": 10000,
            "optin_id": null,
            "extra": null,
            "new_contact": false
        },
        "db_assertions": [
            {
                "query": "SELECT status, last_seen_on::text FROM contacts_contact WHERE id = 10000",
                "columns": {
                    "last_seen_on": "2025-05-04 12:31:09.123457+00",
                    "status": "A"
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-113b-76f8-bd38-d266ec8d3716",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Facebook",
                        "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                    },
                    "created_on": "2025-05-04T12:30:49.123456789Z",
                    "type": "chat_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-2c93-76f8-8f41-6b2d9f33d623",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:56.123456789Z",
                    "flow": {
                        "name": "Favorites",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-28ab-76f8-8228-9728778b6c98",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-3c33-76f8-ba00-bd7f0d08e671",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:00.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Facebook",
                            "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                        },
                        "locale": "und-US",
                        "text": "What is your favorite color?",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "new conversation on Vonage (no trigger)",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "new_conversation",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": null,
            "extra": null,
            "new_contact": false
        },
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-7e9b-76f8-afcb-91a2073e5459",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Vonage",
                        "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                    },
                    "created_on": "2025-05-04T12:31:17.123456789Z",
                    "type": "chat_started"
                }
            }
        ]
    },
    {
        "label": "welcome message on Vonage",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "welcome_message",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": null,
            "extra": null,
            "new_contact": false
        }
    },
    {
        "label": "referral on Facebook",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "referral",
            "channel_id": 10002,
            "urn_id": 10000,
            "optin_id": null,
            "extra": {
                "referrer_id": "123456"
            },
            "new_contact": false
        },
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-b54b-76f8-8d9f-e51d30290005",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Facebook",
                        "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                    },
                    "created_on": "2025-05-04T12:31:31.123456789Z",
                    "params": {
                        "referrer_id": "123456"
                    },
                    "type": "chat_started"
                }
            }
        ]
    },
    {
        "label": "referral on Vonage",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "referral",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": null,
            "extra": {
                "referrer_id": "123456"
            },
            "new_contact": false
        },
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-d48b-76f8-8ab7-4a517a86045c",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Vonage",
                        "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                    },
                    "created_on": "2025-05-04T12:31:39.123456789Z",
                    "params": {
                        "referrer_id": "123456"
                    },
                    "type": "chat_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-e813-76f8-ba82-c15b24dd577f",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:44.123456789Z",
                    "flow": {
                        "name": "Favorites",
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-28ab-76f8-8228-9728778b6c98",
                    "status": "interrupted",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-ff83-76f8-9014-2c868db4022e",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:50.123456789Z",
                    "flow": {
                        "name": "Pick a Number",
                        "revision": 1,
                        "uuid": "5890fe3a-f204-4661-b74d-025be4ee019c"
                    },
                    "run_uuid": "01969b47-fb9b-76f8-a13f-9238de2a0b76",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-0f23-76f8-ba91-c48ad8c50e6b",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:54.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Vonage",
                            "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                        },
                        "locale": "und-US",
                        "text": "Pick a number between 1-10.",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "optin on Vonage",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "optin",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": 30000,
            "extra": {
                "payload": "30000",
                "title": "Polls"
            },
            "new_contact": false
        },
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-518b-76f8-a8fd-1537ca860f97",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Vonage",
                        "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                    },
                    "created_on": "2025-05-04T12:32:11.123456789Z",
                    "optin": {
                        "name": "Polls",
                        "uuid": "45aec4dd-945f-4511-878f-7d8516fbd336"
                    },
                    "type": "optin_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-6513-76f8-92e8-a5e406ecb2a7",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:16.123456789Z",
                    "flow": {
                        "name": "Pick a Number",
                        "uuid": "5890fe3a-f204-4661-b74d-025be4ee019c"
                    },
                    "run_uuid": "01969b47-fb9b-76f8-a13f-9238de2a0b76",
                    "status": "interrupted",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-7c83-76f8-a71b-fe4af29b871a",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:22.123456789Z",
                    "flow": {
                        "name": "Favorites",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-789b-76f8-8b56-5e92bbfe0e3f",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-8c23-76f8-8631-f6b52b12c734",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:26.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Vonage",
                            "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                        },
                        "locale": "und-US",
                        "text": "What is your favorite color?",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "optout on Vonage",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "optout",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": 30000,
            "extra": {
                "payload": "30000",
                "title": "Polls"
            },
            "new_contact": false
        },
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-ce8b-76f8-9504-776e7d151101",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Vonage",
                        "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                    },
                    "created_on": "2025-05-04T12:32:43.123456789Z",
                    "optin": {
                        "name": "Polls",
                        "uuid": "45aec4dd-945f-4511-878f-7d8516fbd336"
                    },
                    "type": "optin_stopped"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-e213-76f8-87bc-209e78511534",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:48.123456789Z",
                    "flow": {
                        "name": "Favorites",
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-789b-76f8-8b56-5e92bbfe0e3f",
                    "status": "interrupted",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-f983-76f8-9e14-020037f6ddea",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:54.123456789Z",
                    "flow": {
                        "name": "Pick a Number",
                        "revision": 1,
                        "uuid": "5890fe3a-f204-4661-b74d-025be4ee019c"
                    },
                    "run_uuid": "01969b48-f59b-76f8-9c02-6222e1badc14",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b49-0923-76f8-be22-6e6983962829",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:58.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Vonage",
                            "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                        },
                        "locale": "und-US",
                        "text": "Pick a number between 1-10.",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "missed call trigger queued by RP",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "mo_miss",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": 30000,
            "extra": {
                "duration": 123
            },
            "new_contact": false
        },
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b49-4b8b-76f8-a52e-e58736ac73ba",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Vonage",
                        "uuid": "19012bfd-3ce3-4cae-9bb9-76cf92c73d49"
                    },
                    "created_on": "2025-05-04T12:33:15.123456789Z",
                    "type": "call_missed"
                }
            }
        ]
    },
    {
        "label": "stop contact",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "stop_contact",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": null,
            "extra": null,
            "new_contact": false
        },
        "db_assertions": [
            {
                "query": "SELECT status FROM contacts_contact WHERE id = 10000",
                "columns": {
                    "status": "S"
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b49-6acb-76f8-874b-f17fb8365c22",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:33:23.123456789Z",
                    "status": "stopped",
                    "type": "contact_status_changed"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b49-729b-76f8-a2d8-44b4f9caf25c",
                "OrgID": 1,
                "TTL": "2026-05-04T12:33:25Z",
                "Data": {
                    "created_on": "2025-05-04T12:33:25.123456789Z",
                    "groups_removed": [
                        {
                            "name": "Doctors",
                            "uuid": "c153e265-f7c9-4539-9dbc-9b358714b638"
                        }
                    ],
                    "type": "contact_groups_changed"
                }
            }
        ]
    },
    {
        "label": "task to delete contact",
        "contact_uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "delete_contact",
            "channel_id": 10001,
            "urn_id": 10000,
            "optin_id": null,
            "extra": null,
            "new_contact": false
        }
    },
    {
        "label": "new conversation on Facebook for stopped contact, should unstop the contact",
        "contact_uuid": "b699a406-7e44-49be-9f01-1a82893e8a10",
        "task": {
            "event_uuid": "019ae4fc-56c6-7a94-b757-dcf0640e5ebc",
            "event_type": "new_conversation",
            "channel_id": 10002,
            "urn_id": 10001,
            "optin_id": null,
            "extra": null,
            "new_contact": false
        },
        "db_assertions": [
            {
                "query": "SELECT status FROM contacts_contact WHERE id = 10000",
                "columns": {
                    "status": "S"
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b49-9d93-76f8-88da-b2056ae679d2",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:33:36.123456789Z",
                    "status": "active",
                    "type": "contact_status_changed"
                }
            },
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b49-a563-76f8-9bd7-277a6a165264",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Facebook",
                        "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                    },
                    "created_on": "2025-05-04T12:33:38.123456789Z",
                    "type": "chat_started"
                }
            },
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b49-c0bb-76f8-88a2-a356de113e34",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:33:45.123456789Z",
                    "flow": {
                        "name": "Favorites",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b49-bcd3-76f8-851c-386828964858",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b49-d05b-76f8-979e-17606f578787",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:33:49.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Facebook",
                            "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                        },
                        "locale": "und-US",
                        "text": "What is your favorite color?",
                        "urn": "tel:+16055742222"
                    },
                    "type": "msg_created"
                }
            }
        ]
    }
]