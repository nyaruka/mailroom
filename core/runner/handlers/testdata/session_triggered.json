[
    {
        "label": "#1",
        "actions": {
            "a393abc0-283d-4c9b-a1b3-641a035c34bf": [
                {
                    "type": "start_session",
                    "uuid": "d2f852ec-7b4e-457f-ae7f-f8b243c49ff5",
                    "groups": [
                        {
                            "uuid": "5e9d8fab-5e7e-4f51-b533-261af5dea70d"
                        }
                    ],
                    "contacts": [
                        {
                            "uuid": "cd024bcd-f473-4719-a00a-bd0bb1190135",
                            "name": ""
                        }
                    ],
                    "flow": {
                        "uuid": "a7c11d68-f008-496f-b56d-2d5cf4cf16a5",
                        "name": ""
                    },
                    "exclusions": {},
                    "create_contact": true
                }
            ]
        },
        "db_assertions": [
            {
                "query": "select count(*) from flows_flowrun where contact_id = $1 AND status = 'C'",
                "args": [
                    10000
                ],
                "returns": 1
            },
            {
                "query": "select count(*) from flows_flowstart",
                "returns": 0
            }
        ],
        "expected_tasks": {
            "batch/1": [
                {
                    "type": "start_flow",
                    "payload": {
                        "start_id": null,
                        "org_id": 1,
                        "start_type": "F",
                        "created_by_id": null,
                        "flow_id": 10004,
                        "contact_ids": [
                            10002
                        ],
                        "group_ids": [
                            10006
                        ],
                        "exclusions": {
                            "non_active": false,
                            "in_a_flow": false,
                            "started_previously": false,
                            "not_seen_since_days": 0
                        },
                        "create_contact": true,
                        "parent_summary": {
                            "uuid": "01969b47-1523-76f8-bebe-b4a1f677cf4c",
                            "flow": {
                                "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85",
                                "name": "Test Flow",
                                "revision": 1
                            },
                            "contact": {
                                "uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
                                "id": 10000,
                                "name": "Ann",
                                "status": "active",
                                "timezone": "America/Los_Angeles",
                                "created_on": "2021-06-01T12:29:30Z",
                                "urns": [
                                    "tel:+16055741111?id=10000"
                                ],
                                "groups": [
                                    {
                                        "uuid": "c153e265-f7c9-4539-9dbc-9b358714b638",
                                        "name": "Doctors"
                                    }
                                ],
                                "fields": {
                                    "gender": {
                                        "text": "F"
                                    },
                                    "state": {
                                        "text": "Nigeria > Yobe",
                                        "state": "Nigeria > Yobe"
                                    },
                                    "ward": {
                                        "text": "Nigeria > Yobe > Gulani > Dokshi",
                                        "state": "Nigeria > Yobe",
                                        "district": "Nigeria > Yobe > Gulani",
                                        "ward": "Nigeria > Yobe > Gulani > Dokshi"
                                    }
                                }
                            },
                            "status": "active",
                            "results": {}
                        },
                        "session_history": {
                            "parent_uuid": "01969b47-096b-76f8-b86e-4b881f09a186",
                            "ancestors": 1,
                            "ancestors_since_input": 1
                        }
                    }
                }
            ]
        },
        "expected_history": [
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b47-5b73-76f8-9853-0310d032b497",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:08.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-578b-76f8-bec9-e032f4f9af5f",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b47-6b13-76f8-97a3-ae27459a6be4",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:12.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-578b-76f8-bec9-e032f4f9af5f",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#d709c157-4606-4d41-9df3-9e9c9b4ae2d4",
                "SK": "evt#01969b47-c103-76f8-9566-6fb2598c32d6",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:34.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-bd1b-76f8-8f9d-465efd6fbb5e",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#d709c157-4606-4d41-9df3-9e9c9b4ae2d4",
                "SK": "evt#01969b47-d0a3-76f8-977d-88574316827e",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:38.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-bd1b-76f8-8f9d-465efd6fbb5e",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b47-8e3b-76f8-9014-2c868db4022e",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:21.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-8a53-76f8-a13f-9238de2a0b76",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b47-9ddb-76f8-ba91-c48ad8c50e6b",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:25.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-8a53-76f8-a13f-9238de2a0b76",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-190b-76f8-8dbf-00ecf5d03034",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:51.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-1523-76f8-bebe-b4a1f677cf4c",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-384b-76f8-8e78-3bde7b3370ae",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:59.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-1523-76f8-bebe-b4a1f677cf4c",
                    "status": "completed",
                    "type": "run_ended"
                }
            }
        ]
    },
    {
        "label": "#2",
        "actions": {
            "b699a406-7e44-49be-9f01-1a82893e8a10": [
                {
                    "type": "start_session",
                    "uuid": "692926ea-09d6-4942-bd38-d266ec8d3716",
                    "contacts": [
                        {
                            "uuid": "d709c157-4606-4d41-9df3-9e9c9b4ae2d4",
                            "name": ""
                        }
                    ],
                    "flow": {
                        "uuid": "2f81d0ea-4d75-4843-9371-3f7465311cce",
                        "name": ""
                    },
                    "exclusions": {},
                    "create_contact": true
                }
            ]
        },
        "db_assertions": [
            {
                "query": "select count(*) from flows_flowstart",
                "returns": 0
            }
        ],
        "expected_tasks": {
            "batch/1": [
                {
                    "type": "start_flow",
                    "payload": {
                        "start_id": null,
                        "org_id": 1,
                        "start_type": "F",
                        "created_by_id": null,
                        "flow_id": 10003,
                        "contact_ids": [
                            10003
                        ],
                        "exclusions": {
                            "non_active": false,
                            "in_a_flow": false,
                            "started_previously": false,
                            "not_seen_since_days": 0
                        },
                        "create_contact": true,
                        "parent_summary": {
                            "uuid": "01969b48-2a7b-76f8-be22-6e6983962829",
                            "flow": {
                                "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85",
                                "name": "Test Flow",
                                "revision": 1
                            },
                            "contact": {
                                "uuid": "b699a406-7e44-49be-9f01-1a82893e8a10",
                                "id": 10001,
                                "name": "Bob",
                                "status": "active",
                                "timezone": "America/Los_Angeles",
                                "created_on": "2020-12-31T16:45:30Z",
                                "urns": [
                                    "tel:+16055742222?id=10001"
                                ],
                                "fields": {
                                    "joined": {
                                        "text": "2019-01-24T04:32:22Z",
                                        "datetime": "2019-01-24T04:32:22.000000Z"
                                    }
                                }
                            },
                            "status": "active",
                            "results": {}
                        },
                        "session_history": {
                            "parent_uuid": "01969b48-1ec3-76f8-9e14-020037f6ddea",
                            "ancestors": 1,
                            "ancestors_since_input": 1
                        }
                    }
                }
            ]
        },
        "expected_history": [
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b48-2e63-76f8-ad03-b49f80627da4",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:02.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-2a7b-76f8-be22-6e6983962829",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b48-4da3-76f8-92f0-b4a6fcc7080c",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:10.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-2a7b-76f8-be22-6e6983962829",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#d709c157-4606-4d41-9df3-9e9c9b4ae2d4",
                "SK": "evt#01969b48-a393-76f8-8fb7-9f7a1d1cb701",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:32.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-9fab-76f8-b4c4-260cfebfde0b",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#d709c157-4606-4d41-9df3-9e9c9b4ae2d4",
                "SK": "evt#01969b48-b333-76f8-88a2-a356de113e34",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:36.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-9fab-76f8-b4c4-260cfebfde0b",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b48-70cb-76f8-a2d8-44b4f9caf25c",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:19.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-6ce3-76f8-874b-f17fb8365c22",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b48-806b-76f8-802a-9fffea2a27fa",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:32:23.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-6ce3-76f8-874b-f17fb8365c22",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-fb9b-76f8-87bc-209e78511534",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:49.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-f7b3-76f8-998e-ae5bd773804a",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b48-0b3b-76f8-8c15-15a7c0c5228d",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:53.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-f7b3-76f8-998e-ae5bd773804a",
                    "status": "completed",
                    "type": "run_ended"
                }
            }
        ]
    }
]