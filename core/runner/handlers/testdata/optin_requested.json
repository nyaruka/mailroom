[
    {
        "label": "#1",
        "events": {
            "a393abc0-283d-4c9b-a1b3-641a035c34bf": [
                {
                    "uuid": "01969b47-0583-76f8-ae7f-f8b243c49ff5",
                    "type": "msg_received",
                    "created_on": "2025-05-04T12:30:46.123456789Z",
                    "msg": {
                        "urn": "tel:+16055741111",
                        "channel": {
                            "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8",
                            "name": "Twilio"
                        },
                        "text": "start"
                    }
                }
            ]
        },
        "actions": {
            "a393abc0-283d-4c9b-a1b3-641a035c34bf": [
                {
                    "type": "request_optin",
                    "uuid": "06ca7bfd-7ce9-4c16-9d8c-93f82414056b",
                    "optin": {
                        "uuid": "45aec4dd-945f-4511-878f-7d8516fbd336",
                        "name": "Jokes"
                    }
                }
            ],
            "b699a406-7e44-49be-9f01-1a82893e8a10": [
                {
                    "type": "request_optin",
                    "uuid": "b16fea63-3a0c-4f45-8242-158d5e47b718",
                    "optin": {
                        "uuid": "45aec4dd-945f-4511-878f-7d8516fbd336",
                        "name": "Jokes"
                    }
                }
            ],
            "cd024bcd-f473-4719-a00a-bd0bb1190135": [
                {
                    "type": "request_optin",
                    "uuid": "42b6f5aa-d6d0-4f28-b553-676f138ded27",
                    "optin": {
                        "uuid": "45aec4dd-945f-4511-878f-7d8516fbd336",
                        "name": "Jokes"
                    }
                }
            ]
        },
        "db_assertions": [
            {
                "query": "SELECT COUNT(*) FROM msgs_msg WHERE direction = 'O' AND text = '' AND high_priority = true AND contact_id = $1 AND optin_id = $2",
                "args": [
                    10000,
                    30000
                ],
                "returns": 1
            },
            {
                "query": "SELECT COUNT(*) FROM msgs_msg WHERE direction = 'O' AND text = '' AND high_priority = false AND contact_id = $1 AND optin_id = $2",
                "args": [
                    10002,
                    30000
                ],
                "returns": 1
            },
            {
                "query": "SELECT COUNT(*) FROM msgs_msg WHERE direction = 'O' AND contact_id = $1",
                "args": [
                    10001
                ],
                "returns": 0
            }
        ],
        "expected_history": [
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b47-6343-76f8-8768-7d0ba4d4f3e8",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:10.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-5f5b-76f8-be24-6164105d48f2",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#b699a406-7e44-49be-9f01-1a82893e8a10",
                "SK": "evt#01969b47-7ab3-76f8-9566-6fb2598c32d6",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:16.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-5f5b-76f8-be24-6164105d48f2",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b47-9ddb-76f8-9803-f4a851d20f2b",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:25.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-99f3-76f8-92ca-6e1d7f550554",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b47-b163-76f8-bfd7-d22404241e07",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Facebook",
                        "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                    },
                    "created_on": "2025-05-04T12:31:30.123456789Z",
                    "optin": {
                        "name": "Jokes",
                        "uuid": "45aec4dd-945f-4511-878f-7d8516fbd336"
                    },
                    "type": "optin_requested",
                    "urn": "facebook:23456"
                }
            },
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b47-bd1b-76f8-8631-f6b52b12c734",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:33.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-99f3-76f8-92ca-6e1d7f550554",
                    "status": "completed",
                    "type": "run_ended"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-0583-76f8-ae7f-f8b243c49ff5",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:46.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Twilio",
                            "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8"
                        },
                        "text": "start",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_received"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-1cf3-76f8-97a3-ae27459a6be4",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:52.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-190b-76f8-8ab7-4a517a86045c",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-3463-76f8-aaa3-04d3fbce5f9a",
                "OrgID": 1,
                "Data": {
                    "channel": {
                        "name": "Facebook",
                        "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                    },
                    "created_on": "2025-05-04T12:30:58.123456789Z",
                    "optin": {
                        "name": "Jokes",
                        "uuid": "45aec4dd-945f-4511-878f-7d8516fbd336"
                    },
                    "type": "optin_requested",
                    "urn": "facebook:12345"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-401b-76f8-a13f-9238de2a0b76",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:01.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-190b-76f8-8ab7-4a517a86045c",
                    "status": "completed",
                    "type": "run_ended"
                }
            }
        ]
    }
]