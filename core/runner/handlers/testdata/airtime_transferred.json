[
    {
        "label": "#1",
        "events": {
            "a393abc0-283d-4c9b-a1b3-641a035c34bf": [
                {
                    "uuid": "01969b47-47eb-76f8-8e78-3bde7b3370ae",
                    "type": "airtime_transferred",
                    "created_on": "2025-05-04T12:31:03.123456789Z",
                    "external_id": "2237512891",
                    "sender": "tel:+13605551212",
                    "recipient": "tel:+16055741111",
                    "currency": "USD",
                    "amount": 3,
                    "http_logs": [
                        {
                            "url": "https://dvs-api.dtone.com/v1/lookup/mobile-number",
                            "status_code": 200,
                            "request": "POST /v1/lookup/mobile-number HTTP/1.1\r\nHost: dvs-api.dtone.com\r\nUser-Agent: Go-http-client/1.1\r\nContent-Length: 32\r\nAuthorization: Basic a2V5MTIzOnNlc2FtZQ==\r\nContent-Type: application/json\r\nAccept-Encoding: gzip\r\n\r\n{\"mobile_number\":\"+16055741111\"}",
                            "response": "HTTP/1.0 200 OK\r\nContent-Length: 337\r\n\r\n[\n\t{\n\t\t\"country\": {\n\t\t\"iso_code\": \"ECU\",\n\t\t\"name\": \"Ecuador\",\n\t\t\"regions\": null\n\t\t},\n\t\t\"id\": 1596,\n\t\t\"identified\": true,\n\t\t\"name\": \"Claro Ecuador\",\n\t\t\"regions\": null\n\t},\n\t{\n\t\t\"country\": {\n\t\t\"iso_code\": \"ECU\",\n\t\t\"name\": \"Ecuador\",\n\t\t\"regions\": null\n\t\t},\n\t\t\"id\": 1597,\n\t\t\"identified\": false,\n\t\t\"name\": \"CNT Ecuador\",\n\t\t\"regions\": null\n\t}\n]",
                            "elapsed_ms": 1000,
                            "retries": 0,
                            "status": "success",
                            "created_on": "2025-05-04T12:30:55.123456789Z"
                        },
                        {
                            "url": "https://dvs-api.dtone.com/v1/products?type=FIXED_VALUE_RECHARGE&operator_id=1596&per_page=100",
                            "status_code": 200,
                            "request": "GET /v1/products?type=FIXED_VALUE_RECHARGE&operator_id=1596&per_page=100 HTTP/1.1\r\nHost: dvs-api.dtone.com\r\nUser-Agent: Go-http-client/1.1\r\nAuthorization: Basic a2V5MTIzOnNlc2FtZQ==\r\nAccept-Encoding: gzip\r\n\r\n",
                            "response": "HTTP/1.0 200 OK\r\nContent-Length: 2686\r\n\r\n[\n\t{\n\t\t\"availability_zones\": [\n\t\t\t\"INTERNATIONAL\"\n\t\t],\n\t\t\"benefits\": [\n\t\t\t{\n\t\t\t\"additional_information\": null,\n\t\t\t\"amount\": {\n\t\t\t\t\"base\": 3,\n\t\t\t\t\"promotion_bonus\": 0,\n\t\t\t\t\"total_excluding_tax\": 3\n\t\t\t},\n\t\t\t\"type\": \"CREDITS\",\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t\t}\n\t\t],\n\t\t\"description\": \"\",\n\t\t\"destination\": {\n\t\t\t\"amount\": 3,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t},\n\t\t\"id\": 6035,\n\t\t\"name\": \"3 USD\",\n\t\t\"operator\": {\n\t\t\t\"country\": {\n\t\t\t\"iso_code\": \"ECU\",\n\t\t\t\"name\": \"Ecuador\",\n\t\t\t\"regions\": null\n\t\t\t},\n\t\t\t\"id\": 1596,\n\t\t\t\"name\": \"Claro Ecuador\",\n\t\t\t\"regions\": null\n\t\t},\n\t\t\"prices\": {\n\t\t\t\"retail\": {\n\t\t\t\"amount\": 4,\n\t\t\t\"fee\": 0,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t\t},\n\t\t\t\"wholesale\": {\n\t\t\t\"amount\": 3.6,\n\t\t\t\"fee\": 0,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t\t}\n\t\t},\n\t\t\"promotions\": null,\n\t\t\"rates\": {\n\t\t\t\"base\": 0.833333333333333,\n\t\t\t\"retail\": 0.75,\n\t\t\t\"wholesale\": 0.833333333333333\n\t\t},\n\t\t\"regions\": null,\n\t\t\"required_beneficiary_fields\": null,\n\t\t\"required_credit_party_identifier_fields\": [\n\t\t\t[\n\t\t\t\"mobile_number\"\n\t\t\t]\n\t\t],\n\t\t\"required_debit_party_identifier_fields\": null,\n\t\t\"required_sender_fields\": null,\n\t\t\"service\": {\n\t\t\t\"id\": 1,\n\t\t\t\"name\": \"Mobile\"\n\t\t},\n\t\t\"source\": {\n\t\t\t\"amount\": 3.6,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t},\n\t\t\"type\": \"FIXED_VALUE_RECHARGE\",\n\t\t\"validity\": null\n\t\t},\n\t\t{\n\t\t\"availability_zones\": [\n\t\t\t\"INTERNATIONAL\"\n\t\t],\n\t\t\"benefits\": [\n\t\t\t{\n\t\t\t\"additional_information\": null,\n\t\t\t\"amount\": {\n\t\t\t\t\"base\": 6,\n\t\t\t\t\"promotion_bonus\": 0,\n\t\t\t\t\"total_excluding_tax\": 6\n\t\t\t},\n\t\t\t\"type\": \"CREDITS\",\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t\t}\n\t\t],\n\t\t\"description\": \"\",\n\t\t\"destination\": {\n\t\t\t\"amount\": 6,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t},\n\t\t\"id\": 6036,\n\t\t\"name\": \"6 USD\",\n\t\t\"operator\": {\n\t\t\t\"country\": {\n\t\t\t\"iso_code\": \"ECU\",\n\t\t\t\"name\": \"Ecuador\",\n\t\t\t\"regions\": null\n\t\t\t},\n\t\t\t\"id\": 1596,\n\t\t\t\"name\": \"Claro Ecuador\",\n\t\t\t\"regions\": null\n\t\t},\n\t\t\"prices\": {\n\t\t\t\"retail\": {\n\t\t\t\"amount\": 7,\n\t\t\t\"fee\": 0,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t\t},\n\t\t\t\"wholesale\": {\n\t\t\t\"amount\": 6.3,\n\t\t\t\"fee\": 0,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t\t}\n\t\t},\n\t\t\"promotions\": null,\n\t\t\"rates\": {\n\t\t\t\"base\": 0.952380952380952,\n\t\t\t\"retail\": 0.857142857142857,\n\t\t\t\"wholesale\": 0.952380952380952\n\t\t},\n\t\t\"regions\": null,\n\t\t\"required_beneficiary_fields\": null,\n\t\t\"required_credit_party_identifier_fields\": [\n\t\t\t[\n\t\t\t\t\"mobile_number\"\n\t\t\t]\n\t\t],\n\t\t\"required_debit_party_identifier_fields\": null,\n\t\t\"required_sender_fields\": null,\n\t\t\"service\": {\n\t\t\t\"id\": 1,\n\t\t\t\"name\": \"Mobile\"\n\t\t},\n\t\t\"source\": {\n\t\t\t\"amount\": 6.3,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t},\n\t\t\"type\": \"FIXED_VALUE_RECHARGE\",\n\t\t\"validity\": null\n\t}\n]",
                            "elapsed_ms": 1000,
                            "retries": 0,
                            "status": "success",
                            "created_on": "2025-05-04T12:30:57.123456789Z"
                        },
                        {
                            "url": "https://dvs-api.dtone.com/v1/async/transactions",
                            "status_code": 200,
                            "request": "POST /v1/async/transactions HTTP/1.1\r\nHost: dvs-api.dtone.com\r\nUser-Agent: Go-http-client/1.1\r\nContent-Length: 151\r\nAuthorization: Basic a2V5MTIzOnNlc2FtZQ==\r\nContent-Type: application/json\r\nAccept-Encoding: gzip\r\n\r\n{\"external_id\":\"01969b47-3c33-76f8-9654-8a7258fbaae4\",\"product_id\":6035,\"auto_confirm\":true,\"credit_party_identifier\":{\"mobile_number\":\"+16055741111\"}}",
                            "response": "HTTP/1.0 200 OK\r\nContent-Length: 1296\r\n\r\n{\n\t\"benefits\": [\n\t\t{\n\t\t\t\"additional_information\": null,\n\t\t\t\"amount\": {\n\t\t\t\t\"base\": 3,\n\t\t\t\t\"promotion_bonus\": 0,\n\t\t\t\t\"total_excluding_tax\": 3\n\t\t\t},\n\t\t\t\"type\": \"CREDITS\",\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t}\n\t],\n\t\"confirmation_date\": \"2021-03-24T20:05:06.111631000Z\",\n\t\"confirmation_expiration_date\": \"2021-03-24T21:05:05.883561000Z\",\n\t\"creation_date\": \"2021-03-24T20:05:05.883561000Z\",\n\t\"credit_party_identifier\": {\n\t\t\"mobile_number\": \"+593979123456\"\n\t},\n\t\"external_id\": \"EX12345\",\n\t\"id\": 2237512891,\n\t\"prices\": {\n\t\t\"retail\": {\n\t\t\t\"amount\": 4,\n\t\t\t\"fee\": 0,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t},\n\t\t\"wholesale\": {\n\t\t\t\"amount\": 3.6,\n\t\t\t\"fee\": 0,\n\t\t\t\"unit\": \"USD\",\n\t\t\t\"unit_type\": \"CURRENCY\"\n\t\t}\n\t},\n\t\"product\": {\n\t\t\"description\": \"\",\n\t\t\"id\": 6035,\n\t\t\"name\": \"3 USD\",\n\t\t\"operator\": {\n\t\t\t\"country\": {\n\t\t\t\t\"iso_code\": \"ECU\",\n\t\t\t\t\"name\": \"Ecuador\",\n\t\t\t\t\"regions\": null\n\t\t\t},\n\t\t\t\"id\": 1596,\n\t\t\t\"name\": \"Claro Ecuador\",\n\t\t\t\"regions\": null\n\t\t},\n\t\t\"regions\": null,\n\t\t\"service\": {\n\t\t\t\"id\": 1,\n\t\t\t\"name\": \"Mobile\"\n\t\t},\n\t\t\"type\": \"FIXED_VALUE_RECHARGE\"\n\t},\n\t\"promotions\": null,\n\t\"rates\": {\n\t\t\"base\": 0.833333333333333,\n\t\t\"retail\": 0.75,\n\t\t\"wholesale\": 0.833333333333333\n\t},\n\t\"status\": {\n\t\t\"class\": {\n\t\t\t\"id\": 2,\n\t\t\t\"message\": \"CONFIRMED\"\n\t\t},\n\t\t\"id\": 20000,\n\t\t\"message\": \"CONFIRMED\"\n\t}\n}",
                            "elapsed_ms": 1000,
                            "retries": 0,
                            "status": "success",
                            "created_on": "2025-05-04T12:31:00.123456789Z"
                        }
                    ]
                }
            ]
        },
        "db_assertions": [
            {
                "query": "select count(*) from airtime_airtimetransfer where org_id = $1 AND contact_id = $2 AND status = 'S'",
                "args": [
                    1,
                    10000
                ],
                "returns": 1
            },
            {
                "query": "select count(*) from request_logs_httplog where org_id = $1 AND airtime_transfer_id IS NOT NULL AND is_error = FALSE AND url LIKE 'https://dvs-api.dtone.com/v1/%'",
                "args": [
                    1
                ],
                "returns": 3
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-47eb-76f8-8e78-3bde7b3370ae",
                "OrgID": 1,
                "Data": {
                    "type": "airtime_transferred"
                },
                "DataGZ": "H4sIAAAAAAAA/+xZYXPaPBL+Kx59fTHINrZBM5mbXELbzLXJewnp9FpnPMIWRHdGciU5F5Lhv9/IxmAMBnIlk3bedqZ80GpX2tU+z643zyDLaAwQgFbf64+6vtn1ycj0vXHP7BG/ZzqjmPgjx/EhJqAF1CwlAAFMhaJTEiqBmRwTIUgMWiASBCsSh5wBBGxouyZ0TdgdWjZyLASdtmU7Xdfze/2voAXIoyKC4STMz7dtx3ctu9e3QAtIwmIiAAKKJOgPy/Gg67qWbdmgBQSJaEoJU0uxlvpdy7K0apQJQVg0Awjc3pyDFsBTnunNTgvcK5WGCZ9IgL49g0wkAOVrEnU68YM0cUrbseKMtCM+7TxYnYTz/2RpZ8pHNCEmy6YjIvT1FFaZDCMeE4BsCPWlvmdE6iv9eXUzNJp0jQ/D4Z8dq20FImAfuFTI2DhXi24lEebphDCFjPfc1Hc0o0Q7XSqfcaYIU+ZHwibqHhmOrVdPM3XPBX3CinKGjL9jSSMD25/dT8OLpyt2mUT2O/X1nycnVRPDWUqQgdM0oVGu2Pm35Cw3F0UkVeaARTymbIKMyRNNtUD/fw5A4VtY+BYAFIDqYwRgnj+XTDmTOmkWzkPDhtC4+sdWNxy/tP8tYIF61j+BCkCkH1HMAoCM5RqVPH8DvRiAwdltAFqljOFpuR5lOOaiIhNkQjmTWsyyJCmW50sxjbXEcvteZYkwRceU5CIlMrLloLMEC24cdFxx2Js65zc4N8aJ3Ord5fBA3wJ2p9Gd4FSSOJxKgCxYYEQJSiRAsEQQQEBmUUSk3EMeELlulTzmrYPgmwoeZ5GSf9OsdfLu4svgPPx8+vF2EF4Pzj6cXr8fBBmEtsdTIrDiIqTxiX73YjUlIkzxhJxYEO4B/ftBgfnjHXg8pngRJ+xE/IvRbHs9bzuc8QOmCR7RhKpZ+MQZyVPo20KsAnBxORxcX54OL64uTz8GoBDcLfNuRBgZU7Wu9bxSx3FMtb+6urAxF9Pc+zJNW5WNeXWoIq+wj2We906rupoKPuXaUDjiLMsPh2sbFFc4CcljlGQ6fKHCj7mVcs+8crJOkQW0rgfnF8ObFaxUADJGVSG9vTnfkIQV5dvr68Hl2b/KGOUAXA9WTGQkaFpGIAAVAMdEKsqW0XneFhnnGPeqU5AHHXcLzTjGml1QIqV2uS2MuZszd7NmE2+uv9hmYTiE//dzcipoVADguaqjME0a36RbMT8mpJaKP5Q+lc3/vecJkTghzbnR9l7vJpuBWuBP1pEMBFYbISxBDNs9Z+1fa1uYYdt3m1zfsFC/We2FK+vfMypIHBaEFVEsZuGYkiTesTcSJKYqTLFQs3BZnUVFb0l5FcasNWOl4K7OBstjYjLafcr22xW9edM2ScQDjer5skDOVth8yu+9SROSZ2LDUFPiHYGWVnu21u0VJT3ghMZUzbbD+Zcrcd5RSpz3a5e4I+fSssR5W0qc97vEHVTi/J+kxHlt5xcocX3Xdnpw+dtQ4nqub3Xt5W9zvauZ+/nq3V+v4q3n4VtXvFf6zPf/j898LGcs6uSjSBzl2Dl0Rrep+XoTOst9+ef4j4/oKkPWfEC3HPM6keMUY96+53bNHvZttzceYUy6+uXBYpRR6BUfawBnSlcfNqZiGgBUzMFAA3wDgA4ZEb58RmjZfW/lIWvolX4PA8rysiBCsHi43PkwxmqhY0PbMqFj2t2hDRF0EfTalmV5jobz1/K0dW3ymFKxy5CVG3LbvZ7jejVDmgD2XaFJsyHRVmPTer4ZAfjD7Tt9v1/wShGZRehr6NBt05d82/LIYn31t4nF8mY781bf6ys2f8tv9Xk1qAvmWIvOrv781eZB+9rlfQ3z27bMTS3W8fqNffW/9qhb+9LNrnT/2KVh6HLAyKW8TVHc106NEizr3fECvZWgTImUeFI+zdXlu4vrT4Pzpg84G+qOZkktO3TnAZsfuxuyEIRr3dDd/H8BAAD//7DKwdGuHQAA"
            }
        ]
    },
    {
        "label": "#2",
        "events": {
            "cd024bcd-f473-4719-a00a-bd0bb1190135": [
                {
                    "uuid": "01969b48-900b-76f8-a2d8-44b4f9caf25c",
                    "type": "airtime_transferred",
                    "created_on": "2025-05-04T12:32:27.123456789Z",
                    "external_id": "",
                    "sender": "tel:+13605551212",
                    "recipient": "tel:+16055743333",
                    "currency": "",
                    "amount": 0,
                    "http_logs": [
                        {
                            "url": "https://dvs-api.dtone.com/v1/lookup/mobile-number",
                            "request": "POST /v1/lookup/mobile-number HTTP/1.1\r\nHost: dvs-api.dtone.com\r\nUser-Agent: Go-http-client/1.1\r\nContent-Length: 32\r\nAuthorization: Basic a2V5MTIzOnNlc2FtZQ==\r\nContent-Type: application/json\r\nAccept-Encoding: gzip\r\n\r\n{\"mobile_number\":\"+16055743333\"}",
                            "elapsed_ms": 1000,
                            "retries": 0,
                            "status": "connection_error",
                            "created_on": "2025-05-04T12:32:24.123456789Z"
                        }
                    ]
                },
                {
                    "uuid": "01969b48-97db-76f8-881a-ef06948e0f99",
                    "type": "error",
                    "created_on": "2025-05-04T12:32:29.123456789Z",
                    "text": "number lookup failed: unable to connect to server"
                }
            ]
        },
        "db_assertions": [
            {
                "query": "select count(*) from airtime_airtimetransfer where org_id = $1 AND contact_id = $2 AND status = 'F'",
                "args": [
                    1,
                    10002
                ],
                "returns": 0
            },
            {
                "query": "select count(*) from request_logs_httplog where org_id = $1 AND airtime_transfer_id IS NOT NULL AND is_error = TRUE AND url LIKE 'https://dvs-api.dtone.com/v1/%'",
                "args": [
                    1
                ],
                "returns": 1
            }
        ],
        "expected_history": [
            {
                "PK": "con#cd024bcd-f473-4719-a00a-bd0bb1190135",
                "SK": "evt#01969b48-900b-76f8-a2d8-44b4f9caf25c",
                "OrgID": 1,
                "Data": {
                    "amount": 0,
                    "created_on": "2025-05-04T12:32:27.123456789Z",
                    "currency": "",
                    "external_id": "",
                    "http_logs": [
                        {
                            "created_on": "2025-05-04T12:32:24.123456789Z",
                            "elapsed_ms": 1000,
                            "request": "POST /v1/lookup/mobile-number HTTP/1.1\r\nHost: dvs-api.dtone.com\r\nUser-Agent: Go-http-client/1.1\r\nContent-Length: 32\r\nAuthorization: Basic a2V5MTIzOnNlc2FtZQ==\r\nContent-Type: application/json\r\nAccept-Encoding: gzip\r\n\r\n{\"mobile_number\":\"+16055743333\"}",
                            "retries": 0,
                            "status": "connection_error",
                            "url": "https://dvs-api.dtone.com/v1/lookup/mobile-number"
                        }
                    ],
                    "recipient": "tel:+16055743333",
                    "sender": "tel:+13605551212",
                    "type": "airtime_transferred"
                }
            }
        ]
    }
]