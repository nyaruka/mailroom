[
    {
        "label": "add new URN to Ann and send to it",
        "events": {},
        "actions": {
            "a393abc0-283d-4c9b-a1b3-641a035c34bf": [
                {
                    "type": "add_contact_urn",
                    "uuid": "0b54716f-550f-4a90-8868-30a7054c2ec1",
                    "scheme": "telegram",
                    "path": "12345"
                },
                {
                    "type": "set_contact_channel",
                    "uuid": "b3b425f1-2a29-46eb-ac08-c32cb94fd0b8",
                    "channel": {
                        "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91",
                        "name": "telegram"
                    }
                },
                {
                    "type": "send_msg",
                    "uuid": "3c159ef5-b077-476f-ac80-94a60be1f30f",
                    "text": "Ann Message"
                }
            ]
        },
        "db_assertions": [
            {
                "query": "SELECT m.text, m.status, m.channel_id AS msg_channel, u.identity, u.channel_id AS urn_channel FROM msgs_msg m JOIN contacts_contacturn u ON m.contact_urn_id = u.id WHERE m.contact_id = 10000 ORDER BY m.id DESC LIMIT 1",
                "columns": {
                    "identity": "telegram:12345",
                    "msg_channel": 10002,
                    "status": "Q",
                    "text": "Ann Message",
                    "urn_channel": null
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-190b-76f8-8dbf-00ecf5d03034",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:51.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-1523-76f8-bebe-b4a1f677cf4c",
                    "type": "run_started"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-2c93-76f8-9654-8a7258fbaae4",
                "OrgID": 1,
                "TTL": "2026-05-04T12:30:56Z",
                "Data": {
                    "created_on": "2025-05-04T12:30:56.123456789Z",
                    "type": "contact_urns_changed",
                    "urns": [
                        "tel:+16055741111",
                        "telegram:12345"
                    ]
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-3463-76f8-8e78-3bde7b3370ae",
                "OrgID": 1,
                "TTL": "2026-05-04T12:30:58Z",
                "Data": {
                    "created_on": "2025-05-04T12:30:58.123456789Z",
                    "type": "contact_urns_changed",
                    "urns": [
                        "telegram:12345?channel=0f661e8b-ea9d-4bd3-9953-d368340acf91",
                        "tel:+16055741111"
                    ]
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-401b-76f8-b62c-3c781ca3b5da",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:01.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Telegram",
                            "uuid": "0f661e8b-ea9d-4bd3-9953-d368340acf91"
                        },
                        "locale": "eng-US",
                        "text": "Ann Message",
                        "urn": "telegram:12345"
                    },
                    "type": "msg_created"
                }
            },
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-4bd3-76f8-af9c-ff2f1faac4db",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:04.123456789Z",
                    "flow": {
                        "name": "Test Flow",
                        "revision": 1,
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b47-1523-76f8-bebe-b4a1f677cf4c",
                    "status": "completed",
                    "type": "run_ended"
                }
            }
        ]
    }
]