[
    {
        "label": "error if fields not provided",
        "method": "POST",
        "path": "/mi/contact/interrupt",
        "body": {},
        "status": 400,
        "response": {
            "error": "request failed validation: field 'org_id' is required, field 'user_id' is required, field 'contact_ids' is required"
        }
    },
    {
        "label": "interrupts a single contact synchronously",
        "method": "POST",
        "path": "/mi/contact/interrupt",
        "body": {
            "org_id": 1,
            "user_id": 3,
            "contact_ids": [
                10000
            ]
        },
        "status": 200,
        "response": {
            "sessions": 0
        },
        "db_assertions": [
            {
                "query": "SELECT count(*) FROM flows_flowsession WHERE status = 'W'",
                "returns": 1
            },
            {
                "query": "SELECT count(*) FROM flows_flowsession WHERE status = 'W' AND contact_uuid = 'a393abc0-283d-4c9b-a1b3-641a035c34bf'",
                "returns": 0
            },
            {
                "query": "SELECT count(*) FROM flows_flowsession WHERE status = 'I' AND contact_uuid = 'a393abc0-283d-4c9b-a1b3-641a035c34bf'",
                "returns": 1
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-0d53-76f8-bd38-d266ec8d3716",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:48.123456789Z",
                    "flow": {
                        "name": "Favorites",
                        "uuid": "9de3663f-c5c5-4c92-9f45-ecbc09abcc85"
                    },
                    "run_uuid": "01969b48-2693-76f8-92e8-a5e406ecb2a7",
                    "status": "interrupted",
                    "type": "run_ended"
                }
            }
        ]
    },
    {
        "label": "noop if contact doesn't have a waiting session",
        "method": "POST",
        "path": "/mi/contact/interrupt",
        "body": {
            "org_id": 1,
            "user_id": 3,
            "contact_ids": [
                10000
            ]
        },
        "status": 200,
        "response": {
            "sessions": 0
        },
        "db_assertions": [
            {
                "query": "SELECT count(*) FROM flows_flowsession WHERE status = 'W'",
                "returns": 1
            },
            {
                "query": "SELECT count(*) FROM flows_flowsession WHERE status = 'W' AND contact_uuid = 'a393abc0-283d-4c9b-a1b3-641a035c34bf'",
                "returns": 0
            },
            {
                "query": "SELECT count(*) FROM flows_flowsession WHERE status = 'I' AND contact_uuid = 'a393abc0-283d-4c9b-a1b3-641a035c34bf'",
                "returns": 1
            }
        ]
    },
    {
        "label": "queues interrupt task for multiple contacts",
        "method": "POST",
        "path": "/mi/contact/interrupt",
        "body": {
            "org_id": 1,
            "user_id": 3,
            "contact_ids": [
                10001,
                10002
            ]
        },
        "status": 200,
        "response": {
            "sessions": 0
        },
        "expected_tasks": {
            "batch/1": [
                {
                    "type": "interrupt_sessions",
                    "payload": {
                        "contact_ids": [
                            10001,
                            10002
                        ]
                    }
                }
            ]
        }
    }
]