[
    {
        "label": "illegal method",
        "method": "GET",
        "path": "/mi/msg/send",
        "status": 405,
        "response": {
            "error": "illegal method: GET"
        }
    },
    {
        "label": "invalid org_id",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1234,
            "user_id": 2,
            "contact_id": 10000,
            "text": "hello"
        },
        "status": 500,
        "response": {
            "error": "error loading org assets: error loading environment for org 1234: no org with id: 1234"
        }
    },
    {
        "label": "invalid contact_id",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1,
            "user_id": 2,
            "contact_id": 123456789,
            "text": "hello"
        },
        "status": 500,
        "response": {
            "error": "error loading contact: sql: no rows in result set"
        }
    },
    {
        "label": "text only message",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1,
            "user_id": 2,
            "contact_id": 10000,
            "text": "hello"
        },
        "status": 200,
        "response": {
            "contact": {
                "uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "name": "Ann"
            },
            "created_on": "2025-05-04T12:30:47.123456789Z",
            "event": {
                "uuid": "01969b47-096b-76f8-ae7f-f8b243c49ff5",
                "type": "msg_created",
                "created_on": "2025-05-04T12:30:47.123456789Z",
                "msg": {
                    "urn": "tel:+16055741111",
                    "channel": {
                        "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8",
                        "name": "Twilio"
                    },
                    "text": "hello"
                }
            },
            "id": 30000,
            "modified_on": "$recent_timestamp$",
            "status": "Q"
        },
        "db_assertions": [
            {
                "query": "SELECT text, direction, status, created_by_id FROM msgs_msg ORDER BY id DESC LIMIT 1",
                "columns": {
                    "created_by_id": 2,
                    "direction": "O",
                    "status": "Q",
                    "text": "hello"
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-096b-76f8-ae7f-f8b243c49ff5",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:47.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Twilio",
                            "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8"
                        },
                        "text": "hello",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "attachments only message",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1,
            "user_id": 2,
            "contact_id": 10000,
            "attachments": [
                "image/jpeg:https://aws.com/test/test.jpg",
                "audio/mp3:https://aws.com/test/test.mp3"
            ]
        },
        "status": 200,
        "response": {
            "contact": {
                "uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "name": "Ann"
            },
            "created_on": "2025-05-04T12:30:51.123456789Z",
            "event": {
                "uuid": "01969b47-190b-76f8-bd38-d266ec8d3716",
                "type": "msg_created",
                "created_on": "2025-05-04T12:30:51.123456789Z",
                "msg": {
                    "urn": "tel:+16055741111",
                    "channel": {
                        "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8",
                        "name": "Twilio"
                    },
                    "text": "",
                    "attachments": [
                        "image/jpeg:https://aws.com/test/test.jpg",
                        "audio/mp3:https://aws.com/test/test.mp3"
                    ]
                }
            },
            "id": 30001,
            "modified_on": "$recent_timestamp$",
            "status": "Q"
        },
        "db_assertions": [
            {
                "query": "SELECT text, attachments[1] AS attachment_1, attachments[2] AS attachment_2 FROM msgs_msg ORDER BY id DESC LIMIT 1",
                "columns": {
                    "attachment_1": "image/jpeg:https://aws.com/test/test.jpg",
                    "attachment_2": "audio/mp3:https://aws.com/test/test.mp3",
                    "text": ""
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-190b-76f8-bd38-d266ec8d3716",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:30:51.123456789Z",
                    "msg": {
                        "attachments": [
                            "image/jpeg:https://aws.com/test/test.jpg",
                            "audio/mp3:https://aws.com/test/test.mp3"
                        ],
                        "channel": {
                            "name": "Twilio",
                            "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8"
                        },
                        "text": "",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "initial ticket reply",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1,
            "user_id": 4,
            "contact_id": 10000,
            "text": "we can help",
            "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262"
        },
        "status": 200,
        "response": {
            "contact": {
                "uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "name": "Ann"
            },
            "created_on": "2025-05-04T12:30:55.123456789Z",
            "event": {
                "uuid": "01969b47-28ab-76f8-9c0b-2014ddc77094",
                "type": "msg_created",
                "created_on": "2025-05-04T12:30:55.123456789Z",
                "_user": {
                    "uuid": "ea84a3d7-92e4-4a8b-b01f-db11ff83bbb6",
                    "name": "Ed McEditor"
                },
                "msg": {
                    "urn": "tel:+16055741111",
                    "channel": {
                        "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8",
                        "name": "Twilio"
                    },
                    "text": "we can help"
                },
                "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262"
            },
            "id": 30002,
            "modified_on": "$recent_timestamp$",
            "status": "Q"
        },
        "db_assertions": [
            {
                "query": "SELECT text, ticket_uuid::text, created_by_id FROM msgs_msg ORDER BY id DESC LIMIT 1",
                "columns": {
                    "created_by_id": 4,
                    "text": "we can help",
                    "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262"
                }
            },
            {
                "query": "SELECT replied_on::text, last_activity_on::text FROM tickets_ticket WHERE uuid = '01992f54-5ab6-717a-a39e-e8ca91fb7262'",
                "columns": {
                    "last_activity_on": "2025-05-04 12:30:57.123457+00",
                    "replied_on": "2025-05-04 12:30:57.123457+00"
                }
            },
            {
                "query": "SELECT scope, SUM(count)::int FROM orgs_dailycount GROUP BY 1",
                "map": {
                    "msgs:ticketreplies:0:4": 1,
                    "ticketresptime:count": 1,
                    "ticketresptime:total": 326246412
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-28ab-76f8-9c0b-2014ddc77094",
                "OrgID": 1,
                "Data": {
                    "_user": {
                        "name": "Ed McEditor",
                        "uuid": "ea84a3d7-92e4-4a8b-b01f-db11ff83bbb6"
                    },
                    "created_on": "2025-05-04T12:30:55.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Twilio",
                            "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8"
                        },
                        "text": "we can help",
                        "urn": "tel:+16055741111"
                    },
                    "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262",
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "second ticket reply",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1,
            "user_id": 4,
            "contact_id": 10000,
            "text": "what's the problem?",
            "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262"
        },
        "status": 200,
        "response": {
            "contact": {
                "uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "name": "Ann"
            },
            "created_on": "2025-05-04T12:31:00.123456789Z",
            "event": {
                "uuid": "01969b47-3c33-76f8-92a3-d648ab64bccb",
                "type": "msg_created",
                "created_on": "2025-05-04T12:31:00.123456789Z",
                "_user": {
                    "uuid": "ea84a3d7-92e4-4a8b-b01f-db11ff83bbb6",
                    "name": "Ed McEditor"
                },
                "msg": {
                    "urn": "tel:+16055741111",
                    "channel": {
                        "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8",
                        "name": "Twilio"
                    },
                    "text": "what's the problem?"
                },
                "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262"
            },
            "id": 30003,
            "modified_on": "$recent_timestamp$",
            "status": "Q"
        },
        "db_assertions": [
            {
                "query": "SELECT text, ticket_uuid::text, created_by_id FROM msgs_msg ORDER BY id DESC LIMIT 1",
                "columns": {
                    "created_by_id": 4,
                    "text": "what's the problem?",
                    "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262"
                }
            },
            {
                "query": "SELECT replied_on::text, last_activity_on::text FROM tickets_ticket WHERE uuid = '01992f54-5ab6-717a-a39e-e8ca91fb7262'",
                "columns": {
                    "last_activity_on": "2025-05-04 12:31:02.123457+00",
                    "replied_on": "2025-05-04 12:30:57.123457+00"
                }
            },
            {
                "query": "SELECT scope, SUM(count)::int FROM orgs_dailycount GROUP BY 1",
                "map": {
                    "msgs:ticketreplies:0:4": 2,
                    "ticketresptime:count": 1,
                    "ticketresptime:total": 326246412
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-3c33-76f8-92a3-d648ab64bccb",
                "OrgID": 1,
                "Data": {
                    "_user": {
                        "name": "Ed McEditor",
                        "uuid": "ea84a3d7-92e4-4a8b-b01f-db11ff83bbb6"
                    },
                    "created_on": "2025-05-04T12:31:00.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Twilio",
                            "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8"
                        },
                        "text": "what's the problem?",
                        "urn": "tel:+16055741111"
                    },
                    "ticket_uuid": "01992f54-5ab6-717a-a39e-e8ca91fb7262",
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "text message with quick replies",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1,
            "user_id": 2,
            "contact_id": 10000,
            "text": "What is your preferred color?",
            "quick_replies": [
                {
                    "text": "Red"
                },
                {
                    "text": "Green"
                },
                {
                    "text": "Blue",
                    "extra": "like the sky"
                }
            ]
        },
        "status": 200,
        "response": {
            "contact": {
                "uuid": "a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "name": "Ann"
            },
            "created_on": "2025-05-04T12:31:05.123456789Z",
            "event": {
                "uuid": "01969b47-4fbb-76f8-8228-9728778b6c98",
                "type": "msg_created",
                "created_on": "2025-05-04T12:31:05.123456789Z",
                "msg": {
                    "urn": "tel:+16055741111",
                    "channel": {
                        "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8",
                        "name": "Twilio"
                    },
                    "text": "What is your preferred color?",
                    "quick_replies": [
                        {
                            "type": "text",
                            "text": "Red"
                        },
                        {
                            "type": "text",
                            "text": "Green"
                        },
                        {
                            "type": "text",
                            "text": "Blue",
                            "extra": "like the sky"
                        }
                    ]
                }
            },
            "id": 30004,
            "modified_on": "$recent_timestamp$",
            "status": "Q"
        },
        "db_assertions": [
            {
                "query": "SELECT text, quick_replies[1] AS qr_1, quick_replies[2] AS qr_2, quick_replies[3] AS qr_3 FROM msgs_msg ORDER BY id DESC LIMIT 1",
                "columns": {
                    "qr_1": "Red",
                    "qr_2": "Green",
                    "qr_3": "Blue<extra>like the sky",
                    "text": "What is your preferred color?"
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#a393abc0-283d-4c9b-a1b3-641a035c34bf",
                "SK": "evt#01969b47-4fbb-76f8-8228-9728778b6c98",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:05.123456789Z",
                    "msg": {
                        "channel": {
                            "name": "Twilio",
                            "uuid": "74729f45-7f29-4868-9dc4-90e491e3c7d8"
                        },
                        "quick_replies": [
                            {
                                "type": "text",
                                "text": "Red"
                            },
                            {
                                "type": "text",
                                "text": "Green"
                            },
                            {
                                "type": "text",
                                "extra": "like the sky",
                                "text": "Blue"
                            }
                        ],
                        "text": "What is your preferred color?",
                        "urn": "tel:+16055741111"
                    },
                    "type": "msg_created"
                }
            }
        ]
    },
    {
        "label": "message to an unreachable contact",
        "method": "POST",
        "path": "/mi/msg/send",
        "body": {
            "org_id": 1,
            "user_id": 2,
            "contact_id": 30000,
            "text": "Come back"
        },
        "status": 200,
        "response": {
            "contact": {
                "uuid": "f5e5c595-0cba-4eb9-b1e6-41d7f7f0add6",
                "name": "Mr Unreachable"
            },
            "created_on": "2025-05-04T12:31:08.123456789Z",
            "event": {
                "uuid": "01969b47-5b73-76f8-8f41-6b2d9f33d623",
                "type": "msg_created",
                "created_on": "2025-05-04T12:31:08.123456789Z",
                "msg": {
                    "text": "Come back",
                    "locale": "eng",
                    "unsendable_reason": "no_route"
                }
            },
            "id": 30005,
            "modified_on": "$recent_timestamp$",
            "status": "F"
        },
        "db_assertions": [
            {
                "query": "SELECT text, status, failed_reason FROM msgs_msg ORDER BY id DESC LIMIT 1",
                "columns": {
                    "failed_reason": "D",
                    "status": "F",
                    "text": "Come back"
                }
            }
        ],
        "expected_history": [
            {
                "PK": "con#f5e5c595-0cba-4eb9-b1e6-41d7f7f0add6",
                "SK": "evt#01969b47-5b73-76f8-8f41-6b2d9f33d623",
                "OrgID": 1,
                "Data": {
                    "created_on": "2025-05-04T12:31:08.123456789Z",
                    "msg": {
                        "locale": "eng",
                        "text": "Come back",
                        "unsendable_reason": "no_route"
                    },
                    "type": "msg_created"
                }
            }
        ]
    }
]